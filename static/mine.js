(function(){Array.prototype.remove=function(from,to){var rest,_ref;rest=this.slice((to||from)+1||this.length);this.length=(_ref=from<0)!=null?_ref:this.length+{from:from};return this.push.apply(this,rest);};Array.prototype.contains=function(a){var i,_i,_ref;for(i=_i=0,_ref=this.length;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i)if(this[i]===a)return true;return false;};if(!("classList" in document.documentElement)&&Object.defineProperty&&typeof HTMLElement!=='undefined')Object.defineProperty(HTMLElement.prototype,'classList',{get:function(){var self=this;function update(fn){return function(value){var classes=self.className.split(/\s+/),index=classes.indexOf(value);fn(classes,index,value);self.className=classes.join(" ");};}var ret={add:update(function(classes,index,value){~index||classes.push(value);}),remove:update(function(classes,index){~index&&classes.splice(index,1);}),toggle:update(function(classes,index,value){~index?classes.splice(index,1):classes.push(value);}),contains:function(value){return !!~self.className.split(/\s+/).indexOf(value);},item:function(i){return self.className.split(/\s+/)[i]||null;}};Object.defineProperty(ret,'length',{get:function(){return self.className.split(/\s+/).length;}});return ret;}});;}).call(this);(function(){var confirm,confirmCallback,createCookie,dataURItoBlob,guid,readCookie,s4,switchTheme;readCookie=function(name){var c,ca,nameEQ,_i,_len;nameEQ=name+"=";ca=document.cookie.split(';');for(_i=0,_len=ca.length;_i<_len;_i++){c=ca[_i];while(c.charAt(0)===' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)===0)return c.substring(nameEQ.length,c.length);}return null;};window.readCookie=readCookie;createCookie=function(name,value,days){var date,expires;if(days){date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString();}else expires="; expires=Thu, 01-Jan-1970 00:00:01 GMT";return document.cookie=name+"="+value+expires+"; path=/";};window.createCookie=createCookie;dataURItoBlob=function(uri){var ab,byteString,i,ia,mimeString,_i,_ref;byteString=atob(uri.split(',')[1]);mimeString=uri.split(',')[0].split(':')[1].split(':')[0];ab=new ArrayBuffer(byteString.length);ia=new Uint8Array(ab);for(i=_i=0,_ref=byteString.length;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i)ia[i]=byteString.charCodeAt(i);return new Blob([ab],{type:'image/png'});};window.dataURItoBlob=dataURItoBlob;switchTheme=function(){if(readCookie('dark_theme'))createCookie('dark_theme','',-1);else createCookie('dark_theme',1,3650);return window.location.href=window.location.href;};window.switchTheme=switchTheme;confirmCallback=null;window.addEventListener('DOMContentLoaded',function(){var dialogNo,dialogYes,feedback,feedbackSend,feedbackToggle;if(document.getElementById('feedback')!==null){feedback=document.getElementById('feedback').querySelector('div');feedbackToggle=document.getElementById('toggle-feedback');if(feedbackToggle)feedbackToggle.addEventListener('click',function(e){e.preventDefault();if(feedbackToggle.parentElement.className.indexOf('active')===-1){feedbackToggle.parentElement.classList.add('active');return feedback.querySelector('textarea').focus();}else return feedbackToggle.parentElement.classList.remove('active');},false);feedbackSend=document.getElementById('send-feedback');if(feedbackSend)feedbackSend.addEventListener('click',function(e){var feedbackText,formData,xhr;e.preventDefault();feedbackText=document.getElementById('feedback-text');xhr=new XMLHttpRequest();formData=new FormData();xhr.open('POST','/api/feedback');formData.append('feedback',feedbackText.value);xhr.onload=function(){var result;result=(function(){switch(this.status){case 200:return "Thanks! We read every one of these. Keep in mind, though, this feedback is anonymous. <a href='mailto:support@mediacru.sh'>Email us</a> if you want a response.";case 420:return "Sorry, you can't send more feedback today. Try again in 24 hours!";case 413:return "Sorry, that feedback is too long.";default:return "Sorry, something unexpected happened.";}}).call(this);return feedback.innerHTML="<p>"+result+"</p>";};return xhr.send(formData);},false);}dialogYes=document.querySelector('.dialog .yes');dialogNo=document.querySelector('.dialog .no');if(dialogYes!==null){dialogYes.addEventListener('click',function(e){e.preventDefault();if(confirmCallback)confirmCallback(true);confirmCallback=null;return document.querySelector('.dialog').classList.add('hidden');},false);return dialogNo.addEventListener('click',function(e){e.preventDefault();if(confirmCallback)confirmCallback(false);confirmCallback=null;return document.querySelector('.dialog').classList.add('hidden');},false);}},false);confirm=function(callback){confirmCallback=callback;document.querySelector('.dialog').classList.remove('hidden');return document.querySelector('.dialog .no').focus();};window.confirm=confirm;window.addEventListener('keydown',function(e){if(confirmCallback===null)return;if(e.keyCode===27){if(confirmCallback)confirmCallback(false);confirmCallback=null;return document.querySelector('.dialog').classList.add('hidden');}},false);s4=function(){return Math.floor((1+Math.random())*0x10000).toString(16).substring(1);};guid=function(){return s4()+s4()+'-'+s4()+'-'+s4()+'-'+s4()+'-'+s4()+'-'+s4()+s4()+s4();};window.guid=guid;window.getPosition=function(e){var x,y;x=0;y=0;while(true){x+=e.offsetLeft;y+=e.offsetTop;if(e.offsetParent===null)break;e=e.offsetParent;}return [x,y];};window.addEventListener('DOMContentLoaded',function(e){var link,_i,_len,_ref,_results;_ref=document.querySelectorAll('.ad-opt-out');_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){link=_ref[_i];_results.push(link.addEventListener('click',function(e){var a,ad,_j,_k,_l,_len1,_len2,_len3,_ref1,_ref2,_ref3,_results1;e.preventDefault();if(readCookie('ad-opt-out')){e.target.textContent='opt-out';_ref1=document.querySelectorAll('.ad-state');for(_j=0,_len1=_ref1.length;_j<_len1;_j++){a=_ref1[_j];a.textContent='opted-in';}createCookie('ad-opt-out','',-1);}else{e.target.textContent='opt-in';_ref2=document.querySelectorAll('.ad-state');for(_k=0,_len2=_ref2.length;_k<_len2;_k++){a=_ref2[_k];a.textContent='opted-out';}createCookie('ad-opt-out',1,3650);}_ref3=document.querySelectorAll('.advertisement');_results1=[];for(_l=0,_len3=_ref3.length;_l<_len3;_l++){ad=_ref3[_l];_results1.push(ad.innerHTML="Sorry! You won't see any ads again. If you change your mind, <a href='/advertising'>opt-in here</a>.");}return _results1;},false));}return _results;},false);if(!window.embedded)console.log("  -++++:--`                  \n -hddddddddhy+/.             \n-hddddddddddddddhy/.         \n`ydddddddddddddddddddy+`      \n+ddddddhsoooshyooooydddhs:    \nddddddo`     `      ydddddy:  \ndddddh` `yh+  :hy.  yddddddds`  Want to read the unobsfucated source? Check it out\nddddds  :dd:  sdy` .hddddddddh  at https://github.com/MediaCrush/MediaCrush\nddddd/  odh. `hdo  /dddddddh+`\nhdddh. `hds  :dh:  sddddddy-    Send us some pull requests!\n/dddhsssddyssydhssshdddh+-    \n`ydddddddddddddddddddy+`      \n-hddddddddddddddhy/.         \n -hdddddddddyo/-`            \n  -++++/--``                 ");}).call(this);(function(){window.UserHistory=new (function(){var historyEnabled,self,userHistory;self=this;userHistory=[];historyEnabled=true;self.getHistory=function(){return userHistory;};self.getHistoryEnabled=function(){return historyEnabled;};historyEnabled=readCookie('hist-opt-out')===null;userHistory=JSON.parse(window.localStorage.getItem('history'));if(!userHistory)userHistory=[];self.save=function(){return window.localStorage.setItem('history',JSON.stringify(userHistory));};self.add=function(hash){var item,_i,_len;if(!historyEnabled)return;for(_i=0,_len=userHistory.length;_i<_len;_i++){item=userHistory[_i];if(item===hash)return item;}userHistory.push(hash);return self.save();};self.clear=function(){userHistory=[];return self.save();};self.remove=function(hash){var i,_i,_ref;for(i=_i=0,_ref=userHistory.length;0<=_ref?_i<=_ref:_i>=_ref;i=0<=_ref?++_i:--_i)if(userHistory[i]===hash){userHistory.splice(i,1);break;}return self.save();};self.toggleHistoryEnabled=function(){if(historyEnabled)createCookie('hist-opt-out','1',3650);else createCookie('hist-opt-out','',0);historyEnabled=!historyEnabled;return historyEnabled;};self.loadDetailedHistory=function(items,callback){var hashes,xhr;if(items.length===0)callback([]);hashes=items.join(',');xhr=new XMLHttpRequest();xhr.open('GET','/api/info?list='+hashes);xhr.onload=function(){if(xhr.status!==200){document.getElementById('items').innerHTML='There was an error showing your history, sorry.';return;}if(callback)return callback(JSON.parse(this.response));};return xhr.send();};return self;})();}).call(this);(function(){var API;(function(xhr){var open;open=XMLHttpRequest.prototype.open;return xhr.prototype.open=function(){open.apply(this,arguments);return this.setRequestHeader('X-Requested-With','XMLHttpRequest');};})(XMLHttpRequest);API=new (function(){var self;self=this;self.uploadFile=function(file,progress,callback){var formData,xhr;xhr=new XMLHttpRequest();xhr.open('POST','/api/upload/file');xhr.upload.onprogress=progress;xhr.onload=function(){var error,response;switch(this.status){case 415:error="This media format is not supported.";break;case 420:error="You're uploading too much! Try again later.";break;case 409:response=JSON.parse(this.responseText);file.isUserOwned=false;file.hash=response.hash;file.isHashed=true;file.updateStatus('done');break;case 200:response=JSON.parse(this.responseText);file.isUserOwned=true;file.hash=response.hash;file.isHashed=true;file.updateStatus('pending');}if(error!=null){if(callback)return callback({error:error});}else if(callback)return callback({file:file});};formData=new FormData();formData.append('file',file.file);return xhr.send(formData);};self.uploadUrl=function(file,callback){var formData,xhr;xhr=new XMLHttpRequest();xhr.open('POST','/api/upload/url');file.updateStatus('uploading');file.preview.querySelector('.progress').style.width='100%';xhr.onload=function(){var error,response;switch(this.status){case 400:error="This URL is not valid.";break;case 404:error="That URL does not exist, so far as we can tell.";break;case 409:response=JSON.parse(this.responseText);file.isUserOwned=false;file.hash=response.hash;file.isHashed=true;file.updateStatus('done');break;case 413:error="This file is too large.";break;case 415:error="This filetype is not supported.";break;case 420:error="You're uploading too much! Try again later.";break;case 200:response=JSON.parse(this.responseText);file.isUserOwned=true;file.hash=response.hash;file.isHashed=true;file.updateStatus('pending');}if(error)if(callback)callback({file:file,error:error});if(callback)return callback({file:file});};formData=new FormData();formData.append('url',file.file);return xhr.send(formData);};self.checkExists=function(file,callback){var xhr;xhr=new XMLHttpRequest();xhr.open('GET',"/api/"+file.hash+"/exists");xhr.onload=function(){var response;response=JSON.parse(this.responseText);if(callback)return callback(response.exists);};return xhr.send();};self.checkStatus=function(files,callback){var xhr;xhr=new XMLHttpRequest();xhr.open('GET',"/api/status?list="+files);xhr.onload=function(){var response;response=JSON.parse(this.responseText);if(callback)return callback(response);};return xhr.send();};self.deleteFile=function(file){var xhr;xhr=new XMLHttpRequest();xhr.open('DELETE',"/api/"+file);xhr.send();return UserHistory.remove(file);};self.setFlags=function(file,flags){var flag,formData,value,xhr;xhr=new XMLHttpRequest();formData=new FormData();for(flag in flags){value=flags[flag];formData.append(flag,value);}xhr.open('POST',"/api/"+file+"/flags");return xhr.send(formData);};self.createAlbum=function(files,callback){var formData,xhr;xhr=new XMLHttpRequest();formData=new FormData();formData.append('list',files.join(','));xhr.open('POST','/api/album/create');xhr.onload=function(){var result;if(this.status!==200)if(callback)callback({error:true});result=JSON.parse(this.responseText);if(result.error!=null)if(callback)callback({error:true});if(callback)return callback({hash:result.hash});};return xhr.send(formData);};self.zipAlbum=function(hash,callback){var formData,xhr;xhr=new XMLHttpRequest();formData=new FormData();formData.append('hash',hash);xhr.open('POST','/api/album/zip');xhr.onload=function(){var result;if(this.status!==200)if(callback)callback({error:true});result=JSON.parse(this.responseText);if(result.error!=null)if(callback)callback({error:true});if(callback)return callback(result);};return xhr.send(formData);};self.reportFile=function(file){var xhr;xhr=new XMLHttpRequest();xhr.open('POST',"/report/"+window.filename);return xhr.send();};self.setText=function(hash,title,description,callback){var formData,xhr;xhr=new XMLHttpRequest();formData=new FormData();formData.append('title',title);formData.append('description',description);xhr.open('POST',"/api/"+hash+"/text");xhr.onload=function(){if(callback)return callback(self);};return xhr.send(formData);};return self;})();if(typeof window!=="undefined"&&window!==null)window.API=API;}).call(this);(function(){var createMissing,createPagination,createView,detailedHistory,getCurrentPage,itemsPerPage,itemsToLoad,loadCurrentPage,loadPage,paginationLimit;detailedHistory={};itemsToLoad=[];itemsPerPage=10;paginationLimit=4;window.addEventListener('DOMContentLoaded',function(){var disabledText,historyEnabled;historyEnabled=document.getElementById('history-toggle');disabledText=document.getElementById('disabledText');if(!UserHistory.getHistoryEnabled()){disabledText.classList.remove('hidden');historyEnabled.textContent='enable local history';}historyEnabled.addEventListener('click',function(e){e.preventDefault();if(UserHistory.toggleHistoryEnabled()){disabledText.classList.add('hidden');return historyEnabled.textContent='disable local history';}else{disabledText.classList.remove('hidden');return historyEnabled.textContent='enable local history';}},false);document.getElementById('forget-all').addEventListener('click',function(e){e.preventDefault();return confirm(function(a){if(!a)return;UserHistory.clear();return window.location='/mine';});},false);loadCurrentPage();return window.onhashchange=function(){window.scrollTo(0,0);return loadCurrentPage();};},false);loadCurrentPage=function(){var container,first,i,itemsToFetch,k,last,page,reversedHistory;document.getElementById('progress').classList.remove('hidden');createPagination();container=document.getElementById('items');while(container.hasChildNodes())container.removeChild(container.lastChild);page=getCurrentPage();itemsToLoad=[];reversedHistory=UserHistory.getHistory().slice(0).reverse();first=page*itemsPerPage;last=page*itemsPerPage+itemsPerPage;if(last>reversedHistory.length)last=reversedHistory.length;itemsToLoad=reversedHistory.slice(first,last);itemsToFetch=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=itemsToLoad.length;_i<_len;_i++){i=itemsToLoad[_i];if(detailedHistory[i]==null)_results.push(i);}return _results;})();if(itemsToFetch.length>0)return UserHistory.loadDetailedHistory(itemsToFetch,function(result){var k,v;for(k in result){v=result[k];detailedHistory[k]=v;}itemsToLoad=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=itemsToLoad.length;_i<_len;_i++){k=itemsToLoad[_i];_results.push(detailedHistory[k]||k);}return _results;})();loadPage(itemsToLoad);return document.getElementById('progress').classList.add('hidden');});else{itemsToLoad=(function(){var _i,_len,_results;_results=[];for(_i=0,_len=itemsToLoad.length;_i<_len;_i++){k=itemsToLoad[_i];_results.push(detailedHistory[k]);}return _results;})();loadPage(itemsToLoad);return document.getElementById('progress').classList.add('hidden');}};loadPage=function(items){var container,item,_i,_len,_results;container=document.getElementById('items');_results=[];for(_i=0,_len=items.length;_i<_len;_i++){item=items[_i];_results.push(container.appendChild(createView(item)));}return _results;};createMissing=function(item,container){var forget,text;container.id=item;container.className='missing-item';text=document.createElement('div');text.textContent='This item no longer exists.';container.appendChild(text);forget=document.createElement('a');forget.textContent='Remove from history';forget.href='/forget/'+item;(function(item){return forget.addEventListener('click',function(e){e.preventDefault();return confirm(function(a){if(!a)return;UserHistory.remove(item);container.parentElement.removeChild(container);return loadCurrentPage();});},false);})(item);container.appendChild(forget);return container;};createView=function(item,noLink){var a,bar,container,deleteLink,file,forgetLink,outerContainer,preview,source,_i,_j,_len,_len1,_ref,_ref1;if(noLink==null)noLink=false;container=document.createElement('div');if(!item.hash)return createMissing(item,container);else{preview=null;if(item.blob_type==='video'){preview=document.createElement('video');if((item.extras!=null)&&item.extras.length>0)preview.poster=item.extras[0].url;preview.loop=true;_ref=item.files;for(_i=0,_len=_ref.length;_i<_len;_i++){file=_ref[_i];if(file.type==='image/gif')continue;source=document.createElement('source');source.src=window.cdn+file.file;source.type=file.type;preview.appendChild(source);}preview.volume=0;preview.onmouseenter=function(e){return e.target.play();};preview.onmouseleave=function(e){return e.target.pause();};}else if(item.blob_type==='image'){preview=document.createElement('img');preview.src=window.cdn+item.files[0].file;}else if(item.blob_type==='audio'){preview=document.createElement('img');preview.src='/static/audio-player.png';preview.style.marginTop='23px';}else if(item.type==='application/album'){preview=document.createElement('div');preview.className='album-preview';_ref1=item.files.slice(0,4);for(_j=0,_len1=_ref1.length;_j<_len1;_j++){file=_ref1[_j];preview.appendChild(createView(file,true));}}if(preview==null)return createMissing(item,container);preview.classList.add('item');if(!noLink){outerContainer=document.createElement('div');bar=document.createElement('div');bar.className='bar';forgetLink=document.createElement('a');forgetLink.textContent='Forget';forgetLink.className='left';forgetLink.href='/forget/'+item.hash;forgetLink.addEventListener('click',function(e){e.preventDefault();return confirm(function(a){if(!a)return;UserHistory.remove(item.hash);container.parentElement.removeChild(container);return loadCurrentPage();});},false);forgetLink.title='Remove this item from your history';bar.appendChild(forgetLink);deleteLink=document.createElement('a');deleteLink.textContent='Delete';deleteLink.className='right';deleteLink.href='/delete/'+item.hash;deleteLink.addEventListener('click',function(e){e.preventDefault();return confirm(function(a){if(!a)return;UserHistory.remove(item.hash);container.parentElement.removeChild(container);API.deleteFile(item.hash);return loadCurrentPage();});},false);deleteLink.title='Delete this item from the site';bar.appendChild(deleteLink);a=document.createElement('a');a.href='/'+item.hash;a.appendChild(preview);container.appendChild(a);container.appendChild(bar);outerContainer.appendChild(container);outerContainer.className='item-wrapper';return outerContainer;}else{container.appendChild(preview);return container;}}};createPagination=function(){var createButton,history,i,left,page,pages,pagination,right,_i,_j,_len,_ref,_results;history=UserHistory.getHistory();if(history.length<itemsPerPage)return;_ref=document.querySelectorAll('.pagination');_results=[];for(_i=0,_len=_ref.length;_i<_len;_i++){pagination=_ref[_i];while(pagination.hasChildNodes())pagination.removeChild(pagination.lastChild);pages=Math.ceil(history.length/itemsPerPage);page=getCurrentPage();createButton=function(href,text,classes){var content,li;li=document.createElement('li');if(href){content=document.createElement('a');content.href=href;}else content=document.createElement('span');content.textContent=text;li.appendChild(content);pagination.appendChild(li);if(classes)li.className=classes;return content;};if(page>0)createButton("#"+(page-1),"< Prev");left=paginationLimit-1;right=pages-paginationLimit;if(right<left+2||left>pages){right=history.length;left=0;}for(i=_j=0;0<=pages?_j<pages:_j>pages;i=0<=pages?++_j:--_j)if(i<left||i>right||Math.abs(page-i)<paginationLimit)if(page===i)createButton(null,i+1,'selected');else createButton("#"+i,i+1,null);else if((left<page&&page<right)){if(Math.abs(page-i)===paginationLimit)createButton(null,'...','smart-pagination');}else if(i===left||i===right)createButton(null,'...','smart-pagination');if(page<Math.floor(UserHistory.getHistory().length/itemsPerPage))_results.push(createButton("#"+(page+1),"Next >"));else _results.push(void 0);}return _results;};getCurrentPage=function(){var page;page=0;if(window.location.hash.length>=1){page=parseInt(window.location.hash.substr(1));if(page===NaN)page=0;else if(page>=UserHistory.getHistory().length/itemsPerPage){page=Math.ceil(UserHistory.getHistory().length/itemsPerPage-1);window.location.hash='#'+page;}}return page;};}).call(this);